{stash:embed:layouts:{stash:_layout} priority="1"}

{exp:stash:extend name="layout_listing" with="partials:listing_cards"}

{exp:stash:set_list name="listing" parse_tags="yes" parse_conditionals="yes" parse_depth="2"}
  {exp:channel:entries
    require_entry="yes"
    dynamic="off"
    show_future_entries="yes" 
    show_expired="yes"
    channel="{structure:child_listing:short_name}"
    disable="categories|member_data"
    {!-- Tutorials --}
    {if structure:page:entry_id == "63"}entry_id="{structure:child_ids}"{/if}
  }
    {if no_results}{redirect="404"}{/if}
    
    {stash:embed:models:listing_common process="start" parse="no"}
    
    {if channel_short_name ~ "/resource_articles|resource_podcasts|resource_presentations|resource_videos|resource_whitepapers/"}
      {stash:embed:models:listing_dates process="start" parse="no"}
    {/if}
    
    {stash:summary}
      {if cf-resource-cv-videos}
        {exp:channel_videos:videos entry_id="{entry_id}" limit="1"}
          <em>Description from {video:service}</em>: {video:description}
        {/exp:channel_videos:videos}
      {if:else}
        {cf-tut-w-description}{!-- tutorial --}
        {cf-resource-w-desc}{!-- most other resources --}
      {/if}
    {/stash:summary}
    
    {exp:stash:set_list:tags name="tags_{entry_id}" parse_tags="yes" parse_conditionals="yes"}
      {if channel_short_name == "resource_presentations" && entry_date > current_time}
        {stash:text}Upcoming{/stash:text}
        {stash:icon}tag-upcoming{/stash:icon}
        {stash:class}info{/stash:class}        
      {/if}
    {/exp:stash:set_list:tags}    
    
  {/exp:channel:entries}
{/exp:stash:set_list}