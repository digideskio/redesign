{stash:embed:layouts:{stash:_layout} priority="1"}

{exp:stash:extend name="layout_listing" with="partials:listing_cards"}
{exp:stash:extend name="layout_bartender" with="partials:bartender"}

{exp:stash:set_list name="listing" parse="yes" parse_depth="2"}
{exp:channel:entries
  require_entry="yes"
  dynamic="off"
  show_future_entries="yes" 
  show_expired="yes"
  fixed_order="{lv:featured_resources}"
  {global:disable_default}
}
  {if no_results}{redirect="404"}{/if}
  
  {stash:embed:models:listing_common process="start" parse="no"}
  
  {stash:summary}
    {cf-tut-w-description}{!-- tutorial --}
    {cf-resource-w-desc}{!-- most other resources --}
  {/stash:summary}
  
  {exp:stash:set_list:tags name="tags_{entry_id}"}
    {stash:text}Featured{/stash:text}
    {stash:icon}tag-favorite{/stash:icon}
    {stash:class}success{/stash:class}
    {stash:filter}tag{/stash:filter}
    
    {stash:text}{channel}{/stash:text}
    {stash:icon}channel-{exp:stringy:slug separator="-" case="lower"}{channel}{/exp:stringy:slug}{/stash:icon}
    {stash:href}{exp:stringy:slug separator="-" case="lower"}{channel}{/exp:stringy:slug}/{/stash:href}
    {stash:filter}tag{/stash:filter}

  {/exp:stash:set_list:tags}
  
{/exp:channel:entries}
{/exp:stash:set_list}

{exp:channel:entries
  channel="{lv-all-resource-channels}"
  entry_id="not {lv:featured_resources}"
  limit="20"
}

  {exp:stash:append_list name="listing" parse="yes" parse_depth="2"}
    {stash:embed:models:listing_common process="start" parse="no"}
    
    {stash:summary}
      {if cf-resource-cv-videos}
        {exp:channel_videos:videos entry_id="{entry_id}" limit="1"}
          <em>Description from {video:service}</em>: {video:description}
        {/exp:channel_videos:videos}
      {if:else}
        {cf-tut-w-description}{!-- tutorial --}
        {cf-resource-w-desc}{!-- most other resources --}
      {/if}
    {/stash:summary}
    
    {if channel_short_name ~ "/resource_articles|resource_podcasts|resource_presentations|resource_videos|resource_whitepapers/"}
      {stash:embed:models:listing_dates process="start" parse="no"}
    {/if}
    
  {/exp:stash:append_list}
  
  {exp:stash:set_list name="tags_{entry_id}"}
    {stash:text}{channel}{/stash:text}
    {stash:icon}channel-{exp:stringy:slug separator="-" case="lower"}{channel}{/exp:stringy:slug}{/stash:icon}
    {stash:href}{exp:stringy:slug separator="-" case="lower"}{channel}{/exp:stringy:slug}/{/stash:href}
    {stash:filter}tag{/stash:filter}
  {/exp:stash:set_list}

{/exp:channel:entries}

{exp:stash:layout_listing_description}
  View all:<br/>
  <ul class="inline">
	  {exp:structure:entries parent_id="{structure:page:entry_id}"}
	  <li>
	    <a href="{page_url}" class="tag" data-tagname="Tools">
      <div class="flag">
        <div class="image"><i class="icon grunticon-channel-{url_title}"></i></div>
        <div class="body">{title}</div>
      </div>
      </a>
	  </li>
	  {/exp:structure:entries}
  </ul>
			
{/exp:stash:layout_listing_description}